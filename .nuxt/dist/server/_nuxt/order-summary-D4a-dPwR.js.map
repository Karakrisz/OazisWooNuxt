{"version":3,"file":"order-summary-D4a-dPwR.js","sources":["../../../../woonuxt_base/app/pages/order-summary.vue"],"sourcesContent":["<script setup lang=\"ts\">\nimport { OrderStatusEnum } from '#woo';\n\nconst { query, params, name } = useRoute();\nconst { customer } = useAuth();\nconst { formatDate, formatPrice } = useHelpers();\nconst { t } = useI18n();\n\nconst order = ref<Order>({});\nconst fetchDelay = ref<boolean>(query.fetch_delay === 'true');\nconst delayLength = 2500;\nconst isLoaded = ref<boolean>(false);\nconst errorMessage = ref('');\n\nconst isGuest = computed(() => !customer.value?.databaseId);\nconst isSummaryPage = computed<boolean>(() => name === 'order-summary');\nconst isCheckoutPage = computed<boolean>(() => name === 'order-received');\nconst orderIsNotCompleted = computed<boolean>(() => order.value?.status !== OrderStatusEnum.COMPLETED);\nconst hasDiscount = computed<boolean>(() => !!parseFloat(order.value?.rawDiscountTotal || '0'));\nconst downloadableItems = computed(() => order.value?.downloadableItems?.nodes || []);\n\nonBeforeMount(() => {\n  /**\n   * This is to close the child PayPal window we open on the checkout page.\n   * It will fire off an event that redirects the parent window to the order summary page.\n   */\n  if (isCheckoutPage.value && (query.cancel_order || query.from_paypal || query.PayerID)) window.close();\n});\n\nonMounted(async () => {\n  await getOrder();\n  /**\n   * WooCommerce sometimes takes a while to update the order status.\n   * This is a workaround to fetch the order again after a delay.\n   * The length of the delay might need to be adjusted depending on your server.\n   */\n\n  if (isCheckoutPage.value && fetchDelay.value && orderIsNotCompleted.value) {\n    setTimeout(() => {\n      getOrder();\n    }, delayLength);\n  }\n});\n\nasync function getOrder() {\n  try {\n    const data = await GqlGetOrder({ id: params.orderId as string });\n    if (data.order) order.value = data.order;\n  } catch (err: any) {\n    errorMessage.value = err?.gqlErrors?.[0].message || 'Could not find order';\n  }\n  isLoaded.value = true;\n}\n\nconst refreshOrder = async () => {\n  isLoaded.value = false;\n  await getOrder();\n};\n\nuseSeoMeta({\n  title() {\n    return isSummaryPage.value ? t('messages.shop.orderSummary') : t('messages.shop.orderReceived');\n  },\n});\n</script>\n\n<template>\n  <div\n    class=\"w-full min-h-[600px] flex items-center p-8 text-gray-800 md:bg-white md:rounded-xl md:mx-auto md:shadow-lg md:my-24 md:mt-8 md:max-w-3xl md:p-16 flex-col\">\n    <LoadingIcon v-if=\"!isLoaded\" class=\"flex-1\" />\n    <template v-else>\n      <div class=\"w-full\">\n        <template v-if=\"isSummaryPage\">\n          <div class=\"flex items-center gap-4\">\n            <NuxtLink\n              to=\"/my-account?tab=orders\"\n              class=\"inline-flex items-center justify-center p-2 border rounded-md\"\n              title=\"Back to orders\"\n              aria-label=\"Back to orders\">\n              <Icon name=\"ion:chevron-back-outline\" />\n            </NuxtLink>\n            <h1 class=\"text-xl font-semibold\">{{ $t('messages.shop.orderSummary') }}</h1>\n          </div>\n        </template>\n        <template v-else-if=\"isCheckoutPage\">\n          <div class=\"flex items-center justify-between w-full mb-2\">\n            <h1 class=\"text-xl font-semibold\">{{ $t('messages.shop.orderReceived') }}</h1>\n            <button\n              v-if=\"orderIsNotCompleted\"\n              type=\"button\"\n              class=\"inline-flex items-center justify-center p-2 bg-white border rounded-md\"\n              title=\"Refresh order\"\n              aria-label=\"Refresh order\"\n              @click=\"refreshOrder\">\n              <Icon name=\"ion:refresh-outline\" />\n            </button>\n          </div>\n          <p>{{ $t('messages.shop.orderThanks') }}</p>\n        </template>\n        <hr class=\"my-8\" />\n      </div>\n      <div v-if=\"order && !isGuest\" class=\"flex-1 w-full\">\n        <div class=\"flex items-center justify-between\">\n          <div>\n            <div class=\"mb-2 text-xs text-gray-400 uppercase\">{{ $t('messages.shop.order') }}</div>\n            <div class=\"leading-none\">#{{ order.databaseId! }}</div>\n          </div>\n          <div>\n            <div class=\"mb-2 text-xs text-gray-400 uppercase\">{{ $t('messages.general.date') }}</div>\n            <div class=\"leading-none\">{{ formatDate(order.date!) }}</div>\n          </div>\n          <div>\n            <div class=\"mb-2 text-xs text-gray-400 uppercase\">{{ $t('messages.general.status') }}</div>\n            <OrderStatusLabel :order=\"order\" />\n          </div>\n          <div>\n            <div class=\"mb-2 text-xs text-gray-400 uppercase\">{{ $t('messages.general.paymentMethod') }}</div>\n            <div class=\"leading-none\">{{ order.paymentMethodTitle }}</div>\n          </div>\n        </div>\n\n        <hr class=\"my-8\" />\n\n        <div class=\"grid gap-2\">\n          <div v-if=\"order.lineItems\" v-for=\"item in order.lineItems.nodes\" :key=\"item.id\" class=\"flex items-center justify-between gap-8\">\n            <NuxtLink v-if=\"item.product?.node\" :to=\"`/product/${item.product.node.slug}`\">\n              <NuxtImg\n                class=\"w-16 h-16 rounded-xl\"\n                :src=\"item.variation?.node?.image?.sourceUrl || item.product.node?.image?.sourceUrl || '/images/placeholder.png'\"\n                :alt=\"item.variation?.node?.image?.altText || item.product.node?.image?.altText || 'Product image'\"\n                :title=\"item.variation?.node?.image?.title || item.product.node?.image?.title || 'Product image'\"\n                width=\"64\"\n                height=\"64\"\n                loading=\"lazy\" />\n            </NuxtLink>\n            <div class=\"flex-1 leading-tight\">\n              {{ item.variation ? item.variation?.node?.name : item.product?.node.name! }}\n            </div>\n            <div class=\"text-sm text-gray-600\">Qty. {{ item.quantity }}</div>\n            <span class=\"text-sm font-semibold\">{{ formatPrice(item.total!) }}</span>\n          </div>\n        </div>\n\n        <hr class=\"my-8\" />\n\n        <div v-if=\"downloadableItems.length && !orderIsNotCompleted\">\n          <DownloadableItems :downloadableItems=\"downloadableItems\" />\n          <hr class=\"my-8\" />\n        </div>\n\n        <div>\n          <div class=\"flex justify-between\">\n            <span>{{ $t('messages.shop.subtotal') }}</span>\n            <span>{{ order.subtotal }}</span>\n          </div>\n          <div class=\"flex justify-between\">\n            <span>{{ $t('messages.general.tax') }}</span>\n            <span>{{ order.totalTax }}</span>\n          </div>\n          <div class=\"flex justify-between\">\n            <span>{{ $t('messages.general.shipping') }}</span>\n            <span>{{ order.shippingTotal }}</span>\n          </div>\n          <div v-if=\"hasDiscount\" class=\"flex justify-between text-primary\">\n            <span>{{ $t('messages.shop.discount') }}</span>\n            <span>- {{ order.discountTotal }}</span>\n          </div>\n          <hr class=\"my-8\" />\n          <div class=\"flex justify-between\">\n            <span class>{{ $t('messages.shop.total') }}</span>\n            <span class=\"font-semibold\">{{ order.total }}</span>\n          </div>\n        </div>\n      </div>\n      <div v-else-if=\"errorMessage\" class=\"flex flex-col items-center justify-center flex-1 w-full gap-4 text-center\">\n        <Icon name=\"ion:sad-outline\" size=\"96\" class=\"text-gray-700\" />\n        <h1 class=\"text-xl font-semibold\">Error</h1>\n        <div v-if=\"errorMessage\" class=\"text-sm text-red-500\" v-html=\"errorMessage\" />\n      </div>\n    </template>\n  </div>\n</template>\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;AAGA,UAAM,EAAE,OAAO,QAAQ,SAAS,SAAS;AACnC,UAAA,EAAE,aAAa;AACrB,UAAM,EAAE,YAAY,YAAY,IAAI,WAAW;AACzC,UAAA,EAAE,MAAM;AAER,UAAA,QAAQ,IAAW,CAAA,CAAE;AACR,QAAa,MAAM,gBAAgB,MAAM;AAEtD,UAAA,WAAW,IAAa,KAAK;AAC7B,UAAA,eAAe,IAAI,EAAE;AAE3B,UAAM,UAAU,SAAS,MAAA;;AAAM,gBAAC,cAAS,UAAT,mBAAgB;AAAA,KAAU;AAC1D,UAAM,gBAAgB,SAAkB,MAAM,SAAS,eAAe;AACtE,UAAM,iBAAiB,SAAkB,MAAM,SAAS,gBAAgB;AACxE,UAAM,sBAAsB,SAAkB;;AAAM,0BAAM,UAAN,mBAAa,YAAW,gBAAgB;AAAA,KAAS;AAC/F,UAAA,cAAc,SAAkB,MAAA;;AAAM,cAAC,CAAC,aAAW,WAAM,UAAN,mBAAa,qBAAoB,GAAG;AAAA,KAAC;AACxF,UAAA,oBAAoB,SAAS;;AAAM,gCAAM,UAAN,mBAAa,sBAAb,mBAAgC,UAAS,CAAA;AAAA,KAAE;AAwCzE,eAAA;AAAA,MACT,QAAQ;AACN,eAAO,cAAc,QAAQ,EAAE,4BAA4B,IAAI,EAAE,6BAA6B;AAAA,MAChG;AAAA,IAAA,CACD;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;"}